*********************************
문서 생성을 위한 파이썬 스크립트
*********************************

이전 판은 스핑크스와 레이텍을 위한 래퍼 (wrapper) 프로그램으로서 파워셸 스크립트들을 제공했다. 이 판은 그것들을 대체하는, 파이썬으로 작성된 프로그램들을 소스 코드와 함께 제공한다.

이전 판과 가장 큰 차이는, 실행 파일들이기 때문에, 파워셸을 더 이상 사용하지 않아도 된다는 것이다. 따라서 WinPython/scripts에 있는 개시 (launch) 스크립트들을 상황에 따라 자유롭게 사용할 수 있다. 물론 docs/bin 디렉토리는 PATH 환경 변수에 포함되어야 한다. 또는 그 디렉토리에 있는 모든 파일들을 PATH 변수에 포함된 디렉토리로 옮겨야 한다. bin 디렉토리의 위치에 대해서는 :ref:`DirectoryTree`\ 를 보라.

다음과 같은 방법으로 각 스크립트의 사용법을 볼 수 있다.

::

  >foo.exe -h


docenv.ini
===========

파워셸 스크립트들의 대부분이 특정 프로그램이나 작업 디렉토리의 경로를 가리키는 변수들을 포함하고 있고, 사용자의 실제 컴퓨터 환경에 맞게 그 변수들의 값을 고쳐야 했다. 이제는 그것을 보다 쉽게 할 수 있다. 래퍼 프로그램들은 :index:`docenv.ini` 파일을 참조한다. 예를 들어, svg2pdf.exe는 docenv.ini를 참조하여 잉크스케이프의 경로를 얻는다. 

::

  [Inkscape]
  path = C:\Program Files\Inkscape\inkscape.com


.. _texini:

texini.exe
===========

이전 판은 스핑크스가 문서를 레이텍으로 변환할 때마다 docs/_templates 디렉토리에 있는 karisphinx.sty 같은 레이텍 스타일 파일들을 ./_build/latex 디렉토리로 복사했다. 이 방식은 nb2pdf.ps1을 이용하여 주피터 노트북 파일을 PDF로 변환할 때 레이텍이 hzguide.cls 파일을 찾지 못하는 문제를 예상하지 못했다. 그래서 이 판은 그 스타일 파일들이 텍 라이브의 로컬 TeXMF 디렉토리에 있다고 전제하도록 변경했다. :ref:`TeXLive`\ 를 보라.

:index:`texini.exe`\ 가 그 레이텍 스타일 파일들을 로컬 TeXMF 디렉토리로 복사한다. 이 프로그램을 실행하기 전에 docenv.ini 파일의 TeX Live 섹션이 제대로 설정되어 있는지 확인하라. 추가로 다음과 같은 옵션들을 사용할 수 있다.

-d
  이 문서화 시스템의 bin 디렉토리를 환경 변수로 저장한다. 파워셸 창에서 작업하는 경우에는 이 설정이 불필요하지만, cmd 창에서 작업하는 경우에는 반드시 필요하다.

-p 
  SumatraPDF의 인버스 서치 기능을 활성화한다. :ref:`Sumatra-PDF`\ 를 보라.

-e 
  TEXEDIT 환경 변수를 설정한다. `xlt`_\ 를 보라.

-f 
  레이텍(XeLaTeX)이 사용할 수 있도록 폰트를 캐시한다. 폰트를 추가할 때마다 폰트 캐시를 해야 한다. :ref:`fonts`\ 를 보라.

-u 
  텍 라이브를 업데이트한다. 텍 라이브 업데이트를 위해서는 인터넷 접근이 허용되어야 한다.
  
docbuild.exe
=============

:index:`docbuild.exe`\ 는 이전 판의 docbuild.ps1을 대체한다. 이 프로그램은 sphinx-build 프로그램을 호출하여 HTML 또는 레이텍 문서를 생성하고 다음과 같은 일들을 추가로 처리한다.

* 앞서 생성된 블록 다이어그램 파일들(.pdf)이 있으면 삭제한다.
* 레이텍 컴파일을 수행하기 전에 SVG 이미지 파일들이 있으면 그것들을 PDF로 변환한다. 이 처리는 잉크스케이프를 요구한다. :ref:`inkscape-svg`\ 를 보라.

다음과 같은 옵션들을 사용할 수 있다.

-s 
  소스 디렉토리를 지정하라. 디폴트는 현재 디렉토리이다.

-b
  빌드 디렉토리를 지정하라. 디폴트는 '_build'이다.

-t
  텍 파일의 이름을 지정하라.

-o 
  텍 파일이 한 번 컴파일된다.

-w 
  텍 파일이 두 번 컴파일된다.

-f
  텍 파일이 세 번 컴파일된다. 색인 파일이 있으면 지정된 언어의 알파벳순으로 정렬되고, 텍 파일이 한 번 더 컴파일된다. 컴파일이 완료된 뒤에 .aux와 같은 부수 파일들이 삭제된다.

-l
  'german' 또는 'ger'와 같이 색인 정렬을 위한 언어를 지정하라. 디폴트는 'korean'이다.

-j
  autojosa.exe가 호출된다. `autojosa.exe`_\ 를 보라.

-e
  strrep.exe가 호출된다. `strrep.exe`_\ 를 보라. 이전 판에서는 이 옵션에 해당하는 기능이 자동으로 작동한다.

-k 
  .aux와 같은 부수 파일들이 삭제되지 않는다. 이 옵션은 -f 옵션을 준 경우에만 유효하다.

-m
  bmind.exe가 호출된다. `bmind.exe`_\ 를 보라. 이전 판에서는 이 옵션에 해당하는 기능이 자동으로 작동한다. 

-c
  빌드 디렉토리가 삭제된다.

-p
  SVG 파일을 PDF로 변환하는 과정이 생략된다.

docbuild.exe는 각 문서 디렉토리에 있는, 다음과 같은 :index:`m.cmd`\ 에 의해 사용된다.

::

  docbuild.exe -t foo.tex %*

영어 문서인 경우에 색인 정렬을 위한 언어 옵션을 추가해야 한다.

::

  docbuild.exe -t foo.tex -l english %*


pyFlutter 매뉴얼과 같이 파이썬 API를 포함하는 문서를 위해서는 다음과 같이 옵션을 추가해야 한다.

::

  docbuild.exe -t foo.tex -m %*

-t 옵션에 주어지는 레이텍 파일의 이름은 conf.py 파일에 명시된 것과 동일해야 한다.

::

  latex_documents = [
      (master_doc, 'foo.tex', '제목', '저자', 'manual'),
  ]

m.cmd에 추가로 주어지는 옵션들은 docbuild.exe에 그대로 전달된다.

HTML 문서를 만들려면 다음과 같이 한다.

::

  >m.cmd html

레이텍 문서를 만들고 한 번 컴파일하려면 다음과 같이 한다.

::

  >m.cmd latex -o

레이텍은 SVG 이미지 형식을 지원하지 않는다. 이 문제를 해결하기 위해 레이텍 컴파일이 시작되기 전에 :index:`svg2pdf.exe`\ 가 호출된다. 이전 판의 svg2pdf.ps1을 대체하는 이 프로그램은 잉크스케이프를 이용하여 SVG 이미지 파일을 PDF로 변환한다. 주피터나 스핑크스에 의해 만들어진 SVG 이미지들이 다소 넓은 여백을 갖고 있다. svg2pdf.exe는 SVG 파일들을 PDF로 변환한 뒤에 이미지에서 여백을 잘라내기 위해 :index:`pdfcrop.exe`\ 를 호출한다. pdfcrop.exe는 텍 라이브에 포함되어 있다.

레이텍 문서를 만들고 온전한 문서가 될 때까지 여러 차례 컴파일하려면 다음과 같이 한다.

::

  >.\m.cmd latex -f

이 경우에 컴파일이 완료된 뒤에 컴파일 과정에서 생긴 .aux를 비롯한 부수 파일들을 삭제하기 위해 :index:`texclean.exe`\ 가 호출된다.

_build 디렉토리를 삭제하려면 다음과 같이 한다.

::

  >.\m.cmd -c

.. _imgsize:

imgsize.exe
============

:index:`imgsize.exe`\ 는 이전 판의 imgsize.ps1을 대체한다. 이 프로그램은 :index:`이미지매직` (\ :index:`ImageMagick`\ )을 이용하여 이미지 파일의 화소 밀도를 바꾼다. 픽셀 크기를 바꾸는 것도 가능하다.

::

  >imgsize.exe *.png

이 명령은 PNG 파일들을 하나씩 다음과 같이 처리한다.

1. 이미지 폭을 픽셀 단위로 잰다.
#. 이미지 폭이 주어진 최대 허용 길이보다 작다면 주어진 값으로 화소 밀도를 바꾼다.
#. 그렇지 않다면 이미지 폭을 최대 허용 크기로 나누어 구한 값으로 화소 밀도를 바꾼다.

결과적으로 이것은 PDF 문서의 글줄 길이보다 크지 않도록 이미지의 폭을 조정한다. 디폴트 화소 밀도는 80 ppc이고 디폴트 허용 크기는 1000 픽셀이다. 이것의 절대 크기는 12.5 cm이다. 만약 어떤 이미지의 폭이 1200 픽셀이라면, 화소 밀도는 96 ppc로 결정되고 그 이미지의 절대 크기는 12.5 cm가 된다.

화소 밀도와 허용 크기를 바꾸려면 다음과 같이 한다.

::

  >imgsize.exe *.png -d 100 -m 1200


imginfo.exe
============

:index:`imginfo.exe`\ 는 이미지매직을 이용하여 픽셀 크기와 같은 이미지 파일의 기본 정보를 보여준다. imgsize.exe 프로그램이 이미지들을 제대로 처리했는지 확인하기 위한 목적으로 이 프로그램이 고안되었다.

::

  >imginfo.exe foo.png 

  Geometry: 814 x 534 + 0 + 0
  Resolution: 80 x 80
  Print size: 10.175 x 6.675
  Units: PixelsPerCentimeter

.. _xlt:

xlt.exe
=========

:index:`xlt.exe`\ 가 이전 판의 tex2pdf.ps1 스크립트를 대체한다.
`docbuild.exe`_\ 는 레이텍 컴파일에서 발생할 수 있는 오류에 대응하도록 고안되지 않았다. docbuild.exe가 시도한 레이텍 컴파일에서 오류가 발생하면 xlt.exe를 이용하여 그 원인을 파악하라. 이 프로그램은 xelatex의 사용을 간편화한 것에 불과하다.

::

  >xlt.exe foo.tex

컴파일 중에 오류가 발생하면 다음과 같이 표시된다.

::

  l.63
  ?

이것은 63번 줄에서 오류가 발생했음을 나타낸다. ``x``\ 를 입력하면 컴파일이 중단된다. ``e``\ 를 입력하면 :index:`TEXEDIT` 환경 변수에 지정된 텍스트 에디터에서 소스 파일이 열리고 커서가 문제의 줄에 위치하게 된다. 
TEXEDIT 환경 변수에는 텍스트 에디터(PATH 환경 변수에 포함되어 있지 않다면 그 경로를 포함하여)와 그 에디터가 취하는 패러미터 형식이 함께 설정되어야 한다. 패러미터 형식은 에디터에 따라 다르다.

::

  atom.cmd %s:%d
  code.cmd -g %s:%d
  emeditor.exe /l %d %s

``%s``\ 는 파일 경로를, ``%d``\ 는 행 번호를 나타낸다.
`texini`_\ 를 보라.

bmind.exe
==========

:index:`bmind.exe`\ 는 이전 판의 bmind.ps1을 대체한다. 이 프로그램은  `docbuild.exe`_ 또는 `xlt.exe`_\ 에 의해 텍 파일이 컴파일될 때 사용된다. 이 프로그램은 .ind 파일을 조작하여 색인 항목들을 PDF 책갈피에 추가한다. 독스트링으로부터 추출된 파이썬 함수들만을 PDF 책갈피에 추가하려면 -p 옵션을 사용해야 한다.
:doc:`docstring`\ 을 보라.

autojosa.exe
=============

한국어의 특징들 가운데 하나가 앞 글자의 끝소리에 따라 조사가 바뀐다는 것이다. 이것은 상호참조에서 약간의 문제를 일으킨다.

::

  식 \eqref{foo}를 보시오.

이 예의 결과가 '식 1를'이라면 어색하게 들린다. 이 문제를 해결하기 위하여 KoTeX 레이텍 패키지는 다음과 같은 자동조사 매크로들을 제공한다. 

::

  \은, \는, \이, \가, \을, \를, \와, \과, \로, \으로, \라, \이라

자동조사 매크로는 앞 글자의 끝소리에 맞게 조사를 붙인다.
:index:`autojosa.exe`\ 는 텍 파일에서 상호참조 매크로를 찾아 조사를 자동조사 매크로로 바꾼다. 위의 예는 아래와 같이 바뀌게 된다.

::

  식 \eqref{foo}\를 보시오.

사용법은 다음과 같다.

::

  >autojosa.exe foo.tex

`docbuild.exe`_\ 에 -j 옵션이 주어지면 autojosa.exe가 호출된다.

strrep.exe
============

레이텍이 제대로 처리하지 못하는 문자열을 스핑크스가 만들어낼 수도 있다.
예를 들어, 주피터에서 어떤 코드가 다음과 같이 공백없는 긴 문자열을 만들어내었다고 가정하자.

:: 

  order=10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,...

레이텍의 정렬 (justification) 알고리듬은 공백없는 문자열을 두 줄로 나누지 못한다.
위의 문자열은 오른쪽 여백까지 이어져서 페이지 밖으로 나가버리게 된다.
이 문제를 피하려면 다음과 같이 바뀌어야 한다.

:: 

  order=10,11,\mbox{}12,13,\mbox{}14,15,\mbox{}16,17,\mbox{}...

이와 같은 처리를 위해 :index:`strrep.exe`\ 가 고안되었다. 
이 프로그램은 이전 판의 literal.ps1 스크립트를 대체한다.
`docbuild.exe`_\ 에 -e 옵션이 주어지면 strrep.exe가 호출된다.

strrep.exe는 docenv.ini 파일의 String Replacement 섹션에 지정된 문자열 패턴 파일을 참조하여 텍 파일에서 특정 문자열들을 찾아 바꾼다.
디폴트 패턴 파일은 :index:`strpattern.tsv`\ 이다. strrep은 현재 작업디렉토리에서 strpattern.tsv를 찾고, 없으면 strrep이 위치한 디렉토리에서 찾는다.
다른 패턴 파일을 지정하는 것이 가능하다.

::

  >strrep.exe foo.tex -p mypattern.tsv

디폴트 패턴 파일로 사용되는 strpattern.tsv는 다음과 같은 조건들로 만들어졌다.

* 두 개의 칼럼이 존재한다.
* 탭 문자로 칼럼이 구분된다.
* 첫 칼럼은 찾을 문자열을, 둘째 칼럼은 바뀔 문자열을 나타낸다.
* 정규표현식을 사용할 수 있다.

::

  "(\d\d),(\d\d)," → "\1,\mbox{}\2,\mbox{}"

대부분의 경우에 이 문자열 치환 처리는 필요하지 않을 것이다.
그러나 즉각 해결하기 어려운, 예상치 못한 문제가 발생했을 때 이 방법이 유용할 것이다.

open.exe
=========

:index:`open.exe`\ 는 docenv.ini 파일의 Text Editor 섹션에 지정된 확장자를 가진 파일들을 지정된 에디터를 이용하여 연다. 다른 확장자들을 가진 파일들은 그것들과 연결된 응용 프로그램에 의해 열린다. 이것은 결과적으로 탐색기에서 파일을 더블클릭하여 여는 것과 비슷하다.
특이 기능은 -s 옵션을 이용하여 텍 라이브에 있는 파일들을 검색하여 열 수 있다는 것이다.

::

  open.exe book.cls -s